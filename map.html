<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mapa de Transporte</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        #map {
            height: 70vh;
            width: 100%;
        }
        .bus-icon {
            width: 40px;
            height: 40px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            cursor: pointer;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            position: relative;
            background-color: #fefefe;
            margin: 10% auto;
            padding: 0;
            border: 1px solid #888;
            width: 80%; 
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <!-- Modales para imágenes y video -->
    <div id="imageModal1" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('imageModal1')">&times;</span>
            <img src="https://www.shutterstock.com/image-photo/sao-paulo-sp-brazil-february-600nw-1142322602.jpg" style="width:100%; height:500px; object-fit: contain; object-position: center;">
        </div>
    </div>

    <div id="imageModal2" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('imageModal2')">&times;</span>
            <img src="https://raw.githubusercontent.com/Alevalenzuelap/Miet-3.0/refs/heads/main/Assets/images/Bus%20vacio.jpeg" style="width:100%; height:500px; object-fit: contain; object-position: center;">
        </div>
    </div>

    <div id="videoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('videoModal')">&times;</span>
            <iframe width="100%" height="500" src="https://www.youtube.com/embed/cgs7SlZRKlg?start=1&autoplay=1&mute=1" frameborder="0" allowfullscreen allow="autoplay"></iframe>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        function openModal(modalId) {
            document.getElementById(modalId).style.display = "block";
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = "none";
        }

        const map = L.map('map').setView([-36.8282, -73.0514], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        navigator.geolocation.getCurrentPosition(position => {
            L.marker([position.coords.latitude, position.coords.longitude], { title: "Tu ubicación actual" }).addTo(map).bindPopup("Tu ubicación actual");
        });

        function createBusIcon(color) {
            const svg = `...`; // El SVG completo va aquí
            return L.divIcon({
                className: 'bus-icon',
                html: `<div style="width: 40px; height: 40px;">${svg}</div>`,
                iconSize: [40, 40]
            });
        }

        function createRandomBuses() {
            const buses = [
                { color: '#FF0000', name: 'Línea 70', modalId: 'imageModal1' },
                { color: '#FFD700', name: 'Línea 71', modalId: 'imageModal2' },
                { color: '#008000', name: 'Línea 56', modalId: 'videoModal' }
            ];

            buses.forEach(bus => {
                const lat = -36.8282 + (Math.random() - 0.5) * 0.05;
                const lng = -73.0514 + (Math.random() - 0.5) * 0.05;
                const timeToArrival = Math.floor(Math.random() * 10 + 1); // Tiempo en minutos
                const busIcon = createBusIcon(bus.color);

                L.marker([lat, lng], { icon: busIcon })
                    .addTo(map)
                    .bindPopup(`<strong>${bus.name}</strong><br>Tiempo estimado de llegada: ${timeToArrival} minutos`)
                    .on('click', function() {
                        openModal(bus.modalId);
                    });
            });
        }

        createRandomBuses();
    </script>
</body>
</html>
